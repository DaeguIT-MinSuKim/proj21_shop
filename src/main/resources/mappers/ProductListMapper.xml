<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="proj21_shop.mapper.ProductListMapper">

	<resultMap type="ProductImageDTO" id="ResProductImg">
		<id column="pro_img_code" property="proImgCode" />
		<result column="pro_imagefilename" property="proImagefilename" />
		<result column="pro_img_state" property="proImgState" />
		<collection property="proNum"  resultMap="proj21_shop.mapper.ProductMapper.ResProduct"/>
	</resultMap>

	<sql id="selectProductJoinProductImageSQL">
		 select  p.pro_num,pro_category,pro_name,pro_price,pro_content,pro_salesrate
		          ,pro_cre_date,pro_status,pro_color,pro_size,pro_quantity,pro_sold,pro_hits,re_replyCount
		          ,pro_img_code,pro_imagefilename,pro_img_state
          from  product p join pro_img i on p.pro_num = i.pro_num
	</sql>

	<sql id="whereSQL">
		<where>
			<if test="proCategory != 0">
				and pro_category = #{proCategory}
			</if>
			<if test="proImgState != 0">
				and pro_img_state = #{proImgState}
			</if>
		</where>
	</sql>
	
	<select id="selectProductByProImgState" parameterType="int" resultMap="ResProductImg">
		<include refid="selectProductJoinProductImageSQL"></include>
		where pro_img_state = #{param1} and pro_category = #{param2} 
	</select>
	
	
</mapper>