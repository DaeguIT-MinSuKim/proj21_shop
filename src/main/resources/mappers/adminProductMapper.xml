<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="proj21_shop.mapper.admin.product.AdminProductMapper">

 <!-- PRODUCT -->
	<!-- <resultMap id="adminProductResult" type="ProductDTO">
	
		<result property="proNum" column="pro_num" />
		<result property="proName" column="pro_name" />
		<result property="proPrice" column="pro_price" />
		
		<result property="proSalesrate" column="pro_salesrate" />
		<result property="proCategory" column="pro_category" />
		<result property="proStatus" column="pro_status" />
		
		<result property="proImgfileName" column="pro_imageFileName" />
		<result property="proCreDate" column="pro_cre_date" />
		<result property="proContent" column="pro_content" />
		
		<result property="proSize" column="pro_size" />
		<result property="proColor" column="pro_color" />
		<result property="proQuantity" column="pro_quantity" />
		<result property="proHits" column="pro_hits" />
		<result property="proSold" column="pro_sold" />
		
	</resultMap>
	
	Product_Detail 
	<resultMap id="productDetailResult" type="productImageDTO">
	
		<result property="proImgCode" column="pro_img_code" />
		<result property="proNum" column="pro_num" />
		<result property="proImagefilename" column="pro_imagefilename" />
		<result property="proImgState" column="pro_img_state" />
		
	</resultMap>
	총 제품 수
	<select id="selectTotalProducts" resultType="int" >
			select count(pro_num) from product	
	</select>
	새로나온 제품 기준 30일
	<select id="selectNewProducts" resultType="int" >
			select count(pro_num) from product	where DATE_ADD(pro_cre_date, INTERVAL 30 DAY)>=NOW();
	</select>
	판매량이 많은 제품
	<select id="selectBestProducts" resultType="int" >
			select count(pro_num) from product	where pro_sold>=10
	</select>
	세일중인 제품
	<select id="selectOffProducts" resultType="int" >
			select count(pro_num) from product	where pro_salesrate>0
	</select>
	후기수 가 많은 제품
	<select id="selectSteadyProducts" resultType="int" >
			select count(pro_num) from product	where re_replyCount>=2
	</select>
	판매 중지된 상품
	<select id="selectOutProducts" resultType="int" >
			select count(pro_num) from product	where pro_status='품절'	
	</select>

	<select id="selectAllProducts" parameterType="java.util.Map" resultMap="adminProductResult">
		select a.* from (
		select rownum rn ,b.*, c.pro_imageFileName
		from product b , product_image c
		where b.pro_code=c.pro_code and
		b.pro_code in (select e.pro_code from product_detail e) and
		c.pro_imagefileType='main_image'
		<if test="direct_pro_status !=null and !direct_pro_status.equals('')">
			and b.pro_status=#{direct_pro_status}
		</if>
		<if test="pro_status !=null and !pro_status.equals('all') ">
			and b.pro_status=#{pro_status}
		</if>
		<if test="pro_category !=null and !pro_category.equals('')">
			and b.pro_category=#{pro_category}
		</if>
		<if test="keyword !=null and !keyword.equals('')">
			and pro_name like '%'||#{keyword}||'%'
		</if>
		order by
		<if test="order_price !=null and !order_price.equals('')">
			<choose>
				<when test="order_price.equals('price_desc')">
					b.pro_price DESC ,
				</when>
				<when test="order_price.equals('price_asc')">
					b.pro_price ASC ,
				</when>
			</choose>
		</if>
		<if test="order_salesRate !=null and !order_salesRate.equals('')">
			<choose>
				<when test="order_salesRate.equals('salesRate_desc')">
					b.pro_salesrate DESC ,
				</when>
				<when test="order_salesRate.equals('salesRate_asc')">
					b.pro_salesrate ASC ,
				</when>
			</choose>
		</if>
		<if test="order_count !=null and !order_count.equals('')">
			<choose>
				<when test="order_count.equals('count_desc')">
					b.pro_count DESC ,
				</when>
				<when test="order_count.equals('count_asc')">
					b.pro_count ASC ,
				</when>
			</choose>
		</if>
		b.pro_code
		) a where rn between (#{section,jdbcType=NUMERIC}-1)*200+(#{pageNum,jdbcType=NUMERIC}-1)*20+1
		and
		(#{section,jdbcType=NUMERIC}-1)*200+#{pageNum,jdbcType=NUMERIC}*20
	</select> -->
</mapper>