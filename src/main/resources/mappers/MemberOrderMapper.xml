<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="proj21_shop.mapper.order.MemberOrderMapper">

<resultMap type="CartDTO" id="ResCart">
		<id property="cartNum" column="cart_num"/>
		<result property="cartProQuantity" column="cart_pro_quantity"/>
		<association property="memberId" javaType="MemberDTO" autoMapping="true">
			<result property= "memberId" column="cart_member_id"/>
		</association>
		<association property="cartProNum" javaType="ProductDTO" autoMapping="true">
			<result property="proNum" column="cart_pro_num"/>
			<result property="proImgfileName" column="pro_imagefilename"/>
		</association>
</resultMap>

	<sql id="selectSQL">
		select cart_num, c.cart_member_id, c.cart_pro_num, cart_pro_quantity, p.pro_imagefilename, p.pro_name, p.pro_price,p.pro_size, p.pro_salesrate 
 		  from cart c join productall p on c.cart_pro_num = p.pro_num 
	</sql>
	
	<select id="selectCartByCartNum" resultMap="ResCart">
		 select cart_num,cart_member_Id,cart_pro_num,cart_pro_quantity
          from cart
        where cart_num = #{cartNum}
	</select>
	
	<select id="selectCartByMemberId" resultMap="ResCart">
	<include refid="selectSQL"></include>
    where cart_member_Id =#{memberId}
	</select>
		
 
 	<insert id="insertCart">
		INSERT INTO cart
			(cart_member_Id, cart_pro_num, cart_pro_quantity)
		  values
			(#{memberId.memberId}, #{cartProNum.proNum}, #{cartProQuantity})
	</insert>
 
	<delete id="deleteCart">
		delete 
		   from cart
		where cart_num = #{cart_num}
	</delete>
	
	<delete id="deleteCarts">
		delete 
		   from cart
		<where>
			cart_num in
				<foreach  collection="list" item = "cartNum" index = "index" open = "(" close = ")" separator=",">
					#{cartNum}
				</foreach>
			</where>
	</delete>
	
	<update id="updateCart">
		update cart
		   	 set cart_pro_quantity = cart_pro_quantity + #{cartProQuantity}
	     where cart_num= #{cartNum}
	</update>
	
</mapper>